<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Yoga Studio Template" />
    <meta name="keywords" content="Yoga, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Violet | Template</title>

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
  </head>

  <body>
    <!-- Page Preloder -->
    <div id="preloder">
      <div class="loader"></div>
    </div>

    <!-- Search model -->
    <div class="search-model">
      <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch">+</div>
        <form class="search-model-form">
          <input type="text" id="search-input" placeholder="Search here....." />
        </form>
      </div>
    </div>
    <!-- Search model end -->

    <!-- Header Section Begin -->
    <!-- Header Section Begin -->
    <header class="header-section">
      <div class="container-fluid">
        <div class="inner-header">
          <div class="logo">
            <a href="./index.html"><img src="img/logo.jpg" alt="" /></a>
          </div>
          <div class="header-right">
            <img src="img/icons/search.png" alt="" class="search-trigger" />
            <img src="img/icons/man.png" alt="" />
            <a href="./shopping-cart.html">
              <img src="img/icons/bag.png" alt="" />
              <span>0</span>
            </a>
          </div>
          
          <nav class="main-menu mobile-menu">
            <ul>
              <li><a href="./index.html">Trang chủ</a></li>
              <li><a href="categories.html">Sản phẩm</a></li>
              <li><a href="./contact.html">Liên hệ</a></li>
              <li id="login"><a href="./login.html">Đăng nhập</a></li>
              <li id="register"><a href="./register.html">Đăng kí</a></li>
              <li id="sign_out" style="display: none;"><a href="./login.html">Đăng xuất</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>
    <!-- Header End -->

    <!-- Product Page Section Beign -->
    <section class="product-page">
      <div class="container">
        <div class="row">
          <div class="col-lg-6" id="img_2">
            
            <!-- <div class="product-slider owl-carousel">
              <div class="product-img">
                <figure  id="img_2">
                 
                </figure>
              </div>
            </div> -->
          </div>
          <div class="col-lg-6">
            <div class="product-content">
              <h2 id="product-name"></h2>
              <div class="pc-meta">
                <h5 id="product-price"></h5>
              </div>
              <p id="short_text">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
                eiusmod tempor incididunt ut labore et dolore magna aliqua. Quis
                ipsum suspendisse ultrices gravida. Risus commodo viverra
                maecenas accumsan lacus vel facilisis.
              </p>
              <div class="support">
                <div class="title">Hỗ trợ mua hàng</div>
                <div class="phone"><strong>0859490555</strong></div>
                <div class="infor">
                  (Sản phẩm chính hãng 100%, đổi trả 30 ngày, Free ship từ 800k)
                </div>
              </div>
              <ul class="tags" style="margin-top:5px;">
                <li id="product_quantity"><span>Số lượng: </span></li>
                <li id="category_show"><span>Category :</span></li>
              </ul>
              <div class="product-quantity">
                <div class="pro-qty">
                  <input id="quantity" type="text" value="1" />
                </div>
              </div>
              <a onclick="handleCart(event)" class="primary-btn pc-btn" id="add-to-cart" style="cursor: pointer;"
                >Thêm vào giỏ hàng</a
              >
            </div>
          </div>
        </div>
        <div class="row">
          <h3>Mô tả chi tiết</h3>
          <p id="long_text"></p>
        </div>
      </div>
    </section>

    <!-- Product Page Section End -->

    <!-- Shop Infomation -->
    <section class="shop-info spad">
      <div class="container">
        <div class="row">
          <div class="col-lg-6">
            <h2>Our Shop</h2>
            <p>
              Chào mừng đến với cửa hàng trực tuyến của chúng tôi! Chúng tôi cung cấp nhiều loại sản phẩm chất lượng cao để đáp ứng nhu cầu của bạn. 
            </p>
          </div>
          <div class="col-lg-6">
            <ul>
              <li><strong>Vị trí:</strong> 123 Ao Sen, Hà Đông, Hà nội</li>
              <li><strong>Liên lạc:</strong> +123 456 7890</li>
              <li><strong>Email:</strong> info@example.com</li>
              <li>
                <strong>Thời gian mở cửa:</strong> Thứ hai đến thứ sáu: 9am - 6pm,
                Thứ 7: 10am - 4pm (Đóng cửa vào chủ nhật)
              </li>
            </ul>
          </div>
          <div class="col-lg-12">
            <div class="title" style="margin-top:20px ;"><h2>Nhận xét</h2></div>
            <div class="write_comment">
              <div class="show_form">
                <div><input type="text" style="width: 100%;" id="comment"></div>
                <div style="display: flex; justify-content: end; margin-top: 5px;"><button style="border-radius: 5px;" onclick="handleMoreComment(event)">Thêm bình luận</button></div>
              </div>
            </div>
            <div class="read_comment">
              <ul id="show_comment">
                <!-- <li>
                  <div class="name"><strong>Nguyễn Văn Thắng</strong></div>
                  <div class="comment">Lorem ipsum dolor sit amet consectetur adipisicing elit. Neque, molestiae porro sit amet odio asperiores quidem quos vel dignissimos labore, provident, nostrum debitis necessitatibus quae eveniet sed enim sapiente adipisci fugiat! Asperiores facilis, possimus dolorum aut esse nulla nemo. Alias, quidem provident quisquam ipsam quos cum nihil voluptas id dignissimos.</div>
                </li>
                <li>
                  <div class="name"><strong>Trương Văn Tuấn</strong></div>
                  <div class="comment">Lorem ipsum dolor sit amet consectetur adipisicing elit. Neque, molestiae porro sit amet odio asperiores quidem quos vel dignissimos labore, provident, nostrum debitis necessitatibus quae eveniet sed enim sapiente adipisci fugiat! Asperiores facilis, possimus dolorum aut esse nulla nemo. Alias, quidem provident quisquam ipsam quos cum nihil voluptas id dignissimos.</div>
                </li> -->
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Related Product Section Begin -->
    <section class="related-product spad">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-center">
            <div class="section-title">
              <h2>Các sản phẩm liên quan</h2>
            </div>
          </div>
        </div>
        <div class="row" id="show_products">
         
        </div>
      </div>
    </section>
    <!-- Related Product Section End -->

    <!-- Footer Section Begin -->
    <footer class="footer-section spad">
      <div class="container">
        <div class="footer-widget">
          <div class="row">
            <div class="col-lg-3 col-sm-6">
              <div class="single-footer-widget">
                <h4>About us</h4>
                <ul>
                  <li>About Us</li>
                  <li>Community</li>
                  <li>Jobs</li>
                  <li>Shipping</li>
                  <li>Contact Us</li>
                </ul>
              </div>
            </div>
            <div class="col-lg-3 col-sm-6">
              <div class="single-footer-widget">
                <h4>Customer Care</h4>
                <ul>
                  <li>Search</li>
                  <li>Privacy Policy</li>
                  <li>2019 Lookbook</li>
                  <li>Shipping & Delivery</li>
                  <li>Gallery</li>
                </ul>
              </div>
            </div>
            <div class="col-lg-3 col-sm-6">
              <div class="single-footer-widget">
                <h4>Our Services</h4>
                <ul>
                  <li>Free Shipping</li>
                  <li>Free Returnes</li>
                  <li>Our Franchising</li>
                  <li>Terms and conditions</li>
                  <li>Privacy Policy</li>
                </ul>
              </div>
            </div>
            <div class="col-lg-3 col-sm-6">
              <div class="single-footer-widget">
                <h4>Information</h4>
                <ul>
                  <li>Payment methods</li>
                  <li>Times and shipping costs</li>
                  <li>Product Returns</li>
                  <li>Shipping methods</li>
                  <li>Conformity of the products</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="social-links-warp">
        <div class="container">
          <div class="social-links">
            <a href="" class="instagram"
              ><i class="fa fa-instagram"></i><span>instagram</span></a
            >
            <a href="" class="pinterest"
              ><i class="fa fa-pinterest"></i><span>pinterest</span></a
            >
            <a href="" class="facebook"
              ><i class="fa fa-facebook"></i><span>facebook</span></a
            >
            <a href="" class="twitter"
              ><i class="fa fa-twitter"></i><span>twitter</span></a
            >
            <a href="" class="youtube"
              ><i class="fa fa-youtube"></i><span>youtube</span></a
            >
            <a href="" class="tumblr"
              ><i class="fa fa-tumblr-square"></i><span>tumblr</span></a
            >
          </div>
        </div>

        <div class="container text-center pt-5">
          <p>
            Copyright &copy;
            <script>
              document.write(new Date().getFullYear());
            </script>
            All rights reserved | This project is made with
            <i class="icon-heart color-danger" aria-hidden="true"></i> by
            <a href="">Team 7</a>
          </p>
        </div>
      </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/main.js"></script>
    <!-- <script src="js/productPage.js"></script> -->
    <script>
      function handleMoreComment(event)
      {
        const user = JSON.parse(localStorage.getItem("user"))
        if(user)
        {
          const comment = document.getElementById("comment").value;
          if(comment == "")
          {
            alert("Bạn phải nhập nội dung bình luận")
          }
          else{
            let url = window.location.href.toString()
            let product_id = parseInt(url.split("?id=")[1])
            const data = {
              comment,
              id_user: user.id,
              id_product: product_id
            }
            fetch("http://localhost:3000/api/write_comment", {
                method: "POST",
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' }
                })
                .then((res) => {
                    return res.json()
                })
                .then((res) => {
                    alert("Thêm bình luận thành công");
                    window.location.reload()
                })
          }
        }
        else{
          alert("Bạn phải đăng nhập để bình luận")
        }
        
      }
      function checkLogin(){
      let user = JSON.parse(localStorage.getItem("user"));
      if(!user)
      {
        document.getElementById("register").style.display="inline-block"
        document.getElementById("login").style.display="inline-block"
        document.getElementById("sign_out").style.display="none"
      }
      else{
        document.getElementById("sign_out").style.display="inline-block"
        document.getElementById("register").style.display="none"
        document.getElementById("login").style.display="none"
      }
    }
    checkLogin()
      const products = JSON.parse(localStorage.getItem("products"))
      const show_products = document.getElementById("show_products")
      show_products.innerHTML = ""
      var img = ""
      var price = 0
      for(let i = 0; i < 4; i++)
      {
        show_products.innerHTML += ` <div class="col-lg-3 col-sm-6">
            <div class="single-product-item">
              <figure>
                <a href="./product-page.html?id=${products[i].id}"><img src="${products[i].img_1}" alt="" /></a>
                <div class="p-status">new</div>
              </figure>
              <div class="product-text">
                <h6>${products[0].name}</h6>
                <p>${products[0].price}</p>
              </div>
            </div>
          </div>`
      }
      const url = window.location.href.toString()
      const id = parseInt(url.split("?id=")[1])
      var quantity = 0
      fetch(`http://localhost:3000/api/product_by_id?id=${id}`)
      .then(res=>res.json())
        
      .then(data => {
        console.log(data)
        img = data[0].img_2
        price = parseInt(data[0].price)
        quantity = parseInt(data[0].quantity)
        document.getElementById("img_2").innerHTML = `<img src="${data[0].img_2}" alt="">`
        document.getElementById("product-name").innerHTML = data[0].name;
        document.getElementById("product-price").innerHTML = data[0].price;
        document.getElementById("short_text").innerHTML = data[0].short_text;
        document.getElementById("long_text").innerHTML = data[0].long_text;
        document.getElementById("product_quantity").innerHTML += data[0].quantity;
      })

      fetch(`http://localhost:3000/api/category_of_product?id=${id}`)
      .then(res=>res.json())
      .then(categories => {
        console.log(categories[0])
        for(let i = 0; i < categories.length;i++)
        {
          document.getElementById("category_show").innerHTML += " " + categories[0].name + ","
        }
        
      })

      fetch(`http://localhost:3000/api/comment_of_product?id=${id}`)
      .then(res=>res.json())
      .then(comments=> {
        const show_comment = document.getElementById("show_comment")
        show_comment.innerHTML = "";
        comments.forEach(comment => {
          show_comment.innerHTML += `
          <li>
                  <div class="name"><strong>${comment.name}</strong></div>
                  <div class="comment">${comment.content}</div>
          </li>
          `
        })
    
        
      })



      function handleCart(event)
      {
        const user = JSON.parse(localStorage.getItem("user"))
        if(user)
        {
          const url = window.location.href.toString()
        const id = parseInt(url.split("?id=")[1])
        var quantityInp = parseInt(document.getElementById("quantity").value)
        if(quantityInp <= 0 || !quantityInp)
        {
          alert("Số lượng không hợp lệ")
        }
        else if(quantityInp > quantity){
          alert("Số lượng hàng không đủ")
        }
        else
        {
          const pro = {
            quantity: parseInt(document.getElementById("quantity").value),
            name:document.getElementById("product-name").innerHTML,
            img,
            id,
            price,
            product_quantity: quantity
          };
        const cart_products = JSON.parse(localStorage.getItem("cart_products"));
        console.log("cart: ",cart_products)
        canPush = true
        if(cart_products)
        {
          isExist = false
          cart_products.forEach(prod => {
            if(prod.id == pro.id)
            {
              if(prod.quantity + pro.quantity > quantity)
              {
                canPush = false
                alert("Sản phẩm không đủ số lượng");
              }
              else{
                isExist = true
                prod.quantity += pro.quantity
              }
            }
          })
          if(!isExist && canPush == true){
            cart_products.push(pro)
          }
          localStorage.setItem("cart_products", JSON.stringify(cart_products))
        }
        else{
          const cart = []
          cart.push(pro)
          localStorage.setItem("cart_products", JSON.stringify(cart))
        }
        if(canPush)alert("Thêm sản phẩm thành công")
        }
        }
        else{
          alert("Bạn cần đăng nhập để thêm vào giỏ hàng")
        }
        
      }
    </script>
    <style>
      .read_comment ul{
        list-style: none;
      }
      .read_comment ul li{
        margin-top: 13px;
        padding-bottom: 5px;
        border-bottom: 2px solid #d9dddc;
      }
    </style>
  </body>
</html>
